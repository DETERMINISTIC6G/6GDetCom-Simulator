[General]
sim-time-limit = 10s
description = "Tutorial 1"

[Task1]
network = d6g.simulations.training_day.solution1.NetworkTask1

*.listener.numApps = 2
*.listener.app[*].typename = "UdpSinkApp"
*.listener.app[0].io.localPort = 1042
*.listener.app[1].io.localPort = 1043

[Task1b]
extends = Task1
*.talker.numApps = 2
*.talker.hasOutgoingStreams = true
*.talker.app[*].typename = "UdpSourceApp"
*.talker.app[*].io.destAddress = "listener"
*.talker.app[*].source.packetLength = 100B - 54B # 54B = 8B (UDP) + 20B (IP) + 14B (ETH MAC) + 4B (ETH FCS) + 8B (ETH PHY)

[Task1c]
extends = Task1b
*.talker.app[0].display-name = "time-triggered"
*.talker.app[0].io.destPort = 1042
*.talker.app[0].source.productionInterval = 10ms

[Task1d]
extends = Task1c
*.talker.app[1].display-name = "bursty"
*.talker.app[1].typename = "UdpSourceApp"
*.talker.app[1].io.destPort = 1043
*.talker.app[1].source.productionInterval = replaceUnit(10 / (sin(dropUnit(simTime())) + 1), "ms")

[Task2]
extends = Task1d
network = d6g.simulations.training_day.solution1.NetworkTask2

*.listener.numApps = 3
*.listener.app[2].io.localPort = 1044

[Task2a]
extends = Task2
*.babblingTalker.numApps = 1
*.babblingTalker.hasOutgoingStreams = true
*.babblingTalker.app[0].typename = "UdpSourceApp"
*.babblingTalker.app[0].io.destAddress = "listener"
*.babblingTalker.app[0].source.packetLength = 1446B
*.babblingTalker.app[0].source.productionInterval = 125us
*.babblingTalker.app[0].io.destPort = 1044

[Task2b]
extends = Task2a

**.hasEgressTrafficShaping = true
**.eth[*].macLayer.queue.numTrafficClasses = 3
**.eth[*].macLayer.queue.*[0].display-name = "best-effort"
**.eth[*].macLayer.queue.*[1].display-name = "bursty"
**.eth[*].macLayer.queue.*[2].display-name = "time-triggered"
**.bridging.directionReverser.reverser.excludeEncapsulationProtocols = ["ieee8021qctag"]

*.talker.bridging.streamIdentifier.identifier.mapping = [{stream: "time-triggered", packetFilter: expr(udp.destPort == 1042)},
                                                         {stream: "bursty", packetFilter: expr(udp.destPort == 1043)}]
*.talker.bridging.streamCoder.encoder.mapping = [{stream: "time-triggered", pcp: 7},
                                                 {stream: "bursty", pcp: 5}]

*.babblingTalker.bridging.streamIdentifier.identifier.mapping = [{stream: "best-effort", packetFilter: expr(udp.destPort == 1043)}]
*.babblingTalker.bridging.streamCoder.encoder.mapping = [{stream: "best-effort", pcp: 0}]

[Task3]
extends = Task2b

**.displayGateSchedules = true
**.gateFilter = "**.eth[2].**"
**.gateScheduleVisualizer.height = 16
**.gateScheduleVisualizer.placementHint = "top"

*.talker.eth[*].macLayer.queue.transmissionGate[2].offset = 0us
*.talker.eth[*].macLayer.queue.transmissionGate[2].durations = [10us, 9990us]
*.talker.eth[*].macLayer.queue.transmissionGate[0..1].offset = 9990us
*.talker.eth[*].macLayer.queue.transmissionGate[0..1].durations = [9990us, 10us]

[Task3a]
extends = Task3

*.bridge.eth[*].macLayer.queue.transmissionGate[2].offset = 9990us
*.bridge.eth[*].macLayer.queue.transmissionGate[2].durations = [10us, 9990us]
*.bridge.eth[*].macLayer.queue.transmissionGate[0..1].offset = 9980us
*.bridge.eth[*].macLayer.queue.transmissionGate[0..1].durations = [9990us, 10us]

[Task3b]
extends = Task3a

**.displayGateSchedules = false

*.bridge.eth[*].macLayer.queue.transmissionSelectionAlgorithm[1].typename = "Ieee8021qCreditBasedShaper"
*.bridge.eth[*].macLayer.queue.transmissionSelectionAlgorithm[1].idleSlope = 100/46 * 50kbps
